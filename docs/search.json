[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "",
    "text": "Do you work with LANDFIRE data and want a faster way to dig into ecological patterns across your landscape? You‚Äôre in the right place.\nThis site features quick R code demonstrations to help you get started (or go deeper) with LANDFIRE data. We recognize the power of well-written code and encourage the LANDFIRE community to build on this foundation of work. These r code examples are designed to be practical, repeatable, and flexible to fit your needs. We hope the coding tools provided can help you automate your work, leverage LANDFIRE, and get solution-oriented support.\nWe want to hear from you. Do you have feedback, ideas, or a cool way you‚Äôre using LANDFIRE data with R? Send them our way.\nLet‚Äôs build a community of practice together."
  },
  {
    "objectID": "index.html#why-this-site",
    "href": "index.html#why-this-site",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "",
    "text": "Do you work with LANDFIRE data and want a faster way to dig into ecological patterns across your landscape? You‚Äôre in the right place.\nThis site features quick R code demonstrations to help you get started (or go deeper) with LANDFIRE data. We recognize the power of well-written code and encourage the LANDFIRE community to build on this foundation of work. These r code examples are designed to be practical, repeatable, and flexible to fit your needs. We hope the coding tools provided can help you automate your work, leverage LANDFIRE, and get solution-oriented support.\nWe want to hear from you. Do you have feedback, ideas, or a cool way you‚Äôre using LANDFIRE data with R? Send them our way.\nLet‚Äôs build a community of practice together."
  },
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "üîç Overview",
    "text": "üîç Overview\n\n\n\n\n\n\n\nLANDFIRE\n\n\n\nA\n\nLANDFIRE Data\n\n\n\nB\n\nR Code Demos\n(You are here)\n\n\n\nA--B\n\n\n\n\nC\n\nTinker around\n\n\n\nB--C\n\n\n\n\nD\n\nInsights & Connections\n\n\n\nC--D"
  },
  {
    "objectID": "index.html#why-does-this-matter",
    "href": "index.html#why-does-this-matter",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "Why does this matter?",
    "text": "Why does this matter?\nLANDFIRE‚Äôs Product Suite is vast and updated regularly. With a rapid annual update schedule, it can be challenging to ensure you‚Äôre working with the most current version. Automating this step with LANDFIRE‚Äôs API toolbox using the R demo code provided on this site can ensure you are using the latest products without any extra work.  \n\n\n\nArea of Interest for these demos: LANDFIRE Map Zone 35"
  },
  {
    "objectID": "index.html#connecting-code-landfire-example",
    "href": "index.html#connecting-code-landfire-example",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "Connecting Code & LANDFIRE: Example",
    "text": "Connecting Code & LANDFIRE: Example\nUsing R and LANDFIRE products to explore trends and automate analyses can improve outcomes. Based on current LANDFIRE Products, the example code and visualizations will be based on Map Zone 35, located in Central Texas. Contained in this map zone are multiple ecosystems that provided a colorful sandbox to explore these coding demonstrations."
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "Getting Started",
    "text": "Getting Started\n\nCheck your R, R-Studio and package versions. We recommend running the most current version of R or R-Studio.\nCheck file paths - is your your R-Studio project correctly set up?\nLet us know if you run into code bugs landfire@tnc.org"
  },
  {
    "objectID": "index.html#disclaimer",
    "href": "index.html#disclaimer",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "Disclaimer",
    "text": "Disclaimer\nThe code provided here is offered as-is, without warranty or guarantee of accuracy, functionality, or fitness for a particular purpose. Like any open-source code, it may not perform identically across all systems, versions of R, RStudio, or associated packages. This content is intended for educational and illustrative purposes only and should not be considered a comprehensive guide to R programming. Users are responsible for validating and adapting the code to suit their specific needs and environments. We cannot assume responsibility for any issues, errors, or outcomes resulting from its use."
  },
  {
    "objectID": "index.html#up-next",
    "href": "index.html#up-next",
    "title": "Explore LANDFIRE with R: Quick Code Demos to Kickstart Your Analysis",
    "section": "Up Next",
    "text": "Up Next\n\ninsert"
  },
  {
    "objectID": "basic_outline.html",
    "href": "basic_outline.html",
    "title": "Basic Outline",
    "section": "",
    "text": "Task centric 1. Download 2. Clip and prep 3. Chart 4. Map 5. Compare 6. Other (e.g., connect to outside packages such as GEE)\nThis would be easier to deal with‚Äîi.e, would make sense to work with data on charts page you already downloaded in that page.\nOR is it product-centric? (no no no)\n\nBpS download, clip, chart\nEVT download, clip, map\nEVC, chart, maybe map?\nFuels-map in a different way\n\nThis is more LANDFIRE forward and totally workable\nRegardless need to do a good job highlighting/formatting so readers can find the code they want"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About this Project",
    "section": "",
    "text": "LANDFIRE (Landscape Fire and Resource Management Planning Tools) is a shared program between the U.S. Department of Agriculture Forest Service Fire and Aviation branch and the U.S. Department of the Interior. LANDFIRE provides 25+ national landscape-scale geo-spatial products, 950 vegetation models, and a suite of tools that support all-lands planning, management, and operations. Included in the product suite are current and historic conditions including ecosystem dynamic models that can be used for conservation, fire planning, and landscape management decisions.\nThe Nature Conservancy (TNC) is a Major Partner in the LANDFIRE Program supported by a cooperative agreement through USDA Forest Service. TNC‚Äôs LANDFIRE Team works closely with the LANDFIRE Business Leads, program staff, and other partners to provide support to LANDFIRE and the user community by:\n\nHelping users understand the strengths, weaknesses, and appropriate uses of LANDFIRE products.\nLocating, obtaining, and using geospatial data, tools, and models for fire and natural resource management, planning, and implementation.\nIdentifying and comparing management priorities, evaluating threats to ecosystems, and exploring outcomes under alternative management scenarios.\n\n\nTNC‚Äôs LANDFIRE Team is advancing conservation outcomes through collaborative ecosystem science by supporting LANDFIRE users as they locate, obtain and apply the diverse suite of LANDFIRE products and data.\n\nCreated by TNC Ecologist, Randy Swaty, this preliminary landscape assessment leverages LANDFIRE‚Äôs unique geospatial products to advance beneficial outcomes for the wildland fire and natural resource communities. The central data in each project are created and managed by the cooperative inter-agency/inter-organizational LANDFIRE program.\nThese charts, maps, and graphs are based on current LANDFIRE products, and provide a starting point for further analysis. All maps, input datasets and further assistance can be obtained by contacting the author, Randy Swaty.\nSubstantial code contributions for GIS data processing by Myles Walimaa."
  },
  {
    "objectID": "about.html#landfire-the-nature-conservancy",
    "href": "about.html#landfire-the-nature-conservancy",
    "title": "About this Project",
    "section": "",
    "text": "LANDFIRE (Landscape Fire and Resource Management Planning Tools) is a shared program between the U.S. Department of Agriculture Forest Service Fire and Aviation branch and the U.S. Department of the Interior. LANDFIRE provides 25+ national landscape-scale geo-spatial products, 950 vegetation models, and a suite of tools that support all-lands planning, management, and operations. Included in the product suite are current and historic conditions including ecosystem dynamic models that can be used for conservation, fire planning, and landscape management decisions.\nThe Nature Conservancy (TNC) is a Major Partner in the LANDFIRE Program supported by a cooperative agreement through USDA Forest Service. TNC‚Äôs LANDFIRE Team works closely with the LANDFIRE Business Leads, program staff, and other partners to provide support to LANDFIRE and the user community by:\n\nHelping users understand the strengths, weaknesses, and appropriate uses of LANDFIRE products.\nLocating, obtaining, and using geospatial data, tools, and models for fire and natural resource management, planning, and implementation.\nIdentifying and comparing management priorities, evaluating threats to ecosystems, and exploring outcomes under alternative management scenarios.\n\n\nTNC‚Äôs LANDFIRE Team is advancing conservation outcomes through collaborative ecosystem science by supporting LANDFIRE users as they locate, obtain and apply the diverse suite of LANDFIRE products and data.\n\nCreated by TNC Ecologist, Randy Swaty, this preliminary landscape assessment leverages LANDFIRE‚Äôs unique geospatial products to advance beneficial outcomes for the wildland fire and natural resource communities. The central data in each project are created and managed by the cooperative inter-agency/inter-organizational LANDFIRE program.\nThese charts, maps, and graphs are based on current LANDFIRE products, and provide a starting point for further analysis. All maps, input datasets and further assistance can be obtained by contacting the author, Randy Swaty.\nSubstantial code contributions for GIS data processing by Myles Walimaa."
  },
  {
    "objectID": "about.html#biophysical-settings-products",
    "href": "about.html#biophysical-settings-products",
    "title": "About this Project",
    "section": "Biophysical Settings Products",
    "text": "Biophysical Settings Products\nA Biophysical Setting (BpS) is a concept that represents the vegetation that may have been dominant on the landscape prior to European colonization of North America and is based on both the current biophysical environment and an approximation of the historical disturbance regime.\n\nLANDFIRE collaborated with experts around the country to create a description and model for every BpS in the US. Find BpS descriptions for your area here.\nCheck out the vegetation modeling website to learn how to integrate BpS into your work.\nRead Blankenship et al.¬†(2021) to learn how the models and descriptions were developed."
  },
  {
    "objectID": "about.html#vegetation-products",
    "href": "about.html#vegetation-products",
    "title": "About this Project",
    "section": "Vegetation Products",
    "text": "Vegetation Products\nLANDFIRE (LF) existing vegetation layers describe the following elements: Existing Vegetation Type (EVT), Existing Vegetation Canopy Cover (EVC), and Existing Vegetation Height (EVH). These layers are created using predictive landscape models based on extensive field-referenced data, satellite imagery and biophysical gradient layers using classification and regression trees.\n\nResources\n\nExisting Vegetation Cover\nExisting Vegetation Height\nExisting Vegetation Type"
  },
  {
    "objectID": "about.html#still-have-questions-landfire-is-here-to-help.",
    "href": "about.html#still-have-questions-landfire-is-here-to-help.",
    "title": "About this Project",
    "section": "Still have questions? LANDFIRE is here to help.",
    "text": "Still have questions? LANDFIRE is here to help.\nAsk the LANDFIRE Helpdesk\nSearch the LANDFIRE Helpdesk Dashboard (see what others are asking and find solutions to common problems)\nSearch (& subscribe to) the LANDFIRE YouTube Channel (see tutorials, Office Hours, quick demonstrations)"
  },
  {
    "objectID": "bps.html",
    "href": "bps.html",
    "title": "Biophysical Settings (BpS) Data",
    "section": "",
    "text": "We use LANDFIRE‚Äôs Biophysical Settings (BpS) data to help us understand the ecological potential of a landscape.\n\nBiophysical Settings represent the vegetation system that may have been dominant on the landscape prior to Euro-American settlement. Read more."
  },
  {
    "objectID": "bps.html#landfire-biophysical-settings-data",
    "href": "bps.html#landfire-biophysical-settings-data",
    "title": "Biophysical Settings (BpS) Data",
    "section": "",
    "text": "We use LANDFIRE‚Äôs Biophysical Settings (BpS) data to help us understand the ecological potential of a landscape.\n\nBiophysical Settings represent the vegetation system that may have been dominant on the landscape prior to Euro-American settlement. Read more."
  },
  {
    "objectID": "bps.html#skills-learned",
    "href": "bps.html#skills-learned",
    "title": "Biophysical Settings (BpS) Data",
    "section": "Skills learned",
    "text": "Skills learned\nOften we want to summarize and visualize spatial data, which can be challenging. Making a simple bar chart is not too hard, but what about making an accessible map that might have several categories (of ecosystems for example), is attractive and is ‚Äòscale appropriate‚Äô in level of detail?\nIn this demonstration we:\n\nDownload LANDFIRE Biophysical Settings (BpS) data, manage and load into R\nCrop, mask and build attribute table for the area\nMake a simple bar chart of the top BpSs using ggplot2\nMake an interactive hexbin map as one way to tackle some of the challenges of mapping categorical raster data.\n\n\nSet up\nTo run the code below you will need to:\n\nSet up a new R-Studio project named something such as ‚Äúr_landfire_demos‚Äù\nCreate two directories, ‚Äúinputs‚Äù and ‚Äúoutputs‚Äù\nDownload ‚Äúbps_demo.zip‚Äù (clicking will initiate the download that will likely land in your ‚ÄúC:‚Äù directory) which contains:\n\nLANDFIRE Map Zone 35 shapefile\nBpS attributes file as a .csv\n\nExtract the ‚Äúbps_demo.zip‚Äù files into the ‚Äúinputs‚Äù directory\nCreate and save a new r-script with a name such as ‚Äúbps_demo_code‚Äù.\n\nOnce this set up is complete, you should be able to copy/paste the code below into the r script you created above."
  },
  {
    "objectID": "bps.html#code-to-load-packages-read-in-datasets-and-create-accessible-palette-for-maps",
    "href": "bps.html#code-to-load-packages-read-in-datasets-and-create-accessible-palette-for-maps",
    "title": "Biophysical Settings (BpS) Data",
    "section": "Code to load packages, read in datasets, and create accessible palette for maps",
    "text": "Code to load packages, read in datasets, and create accessible palette for maps\n\n# install packages if needed\n  # install.packages(\"exactextractr\")\n  # install.packages(\"foreign\")\n  # install.packages(\"leaflet\")\n  # install.packages(\"rlandfire\")\n  # install.packages(\"sf\")\n  # install.packages(\"terra\")\n  # install.packages(\"tidyverse\")\n\n# load packages\nlibrary(exactextractr)\nlibrary(foreign)\nlibrary(htmlwidgets)\nlibrary(leaflet)\nlibrary(rlandfire)\nlibrary(sf)\nlibrary(terra)\nlibrary(tidyverse)\n\n\n# read in Area of Interest (aoi) shapefile, plot to check\n\nshp &lt;- st_read(\"inputs/map_zone_35.shp\", quiet = TRUE) %&gt;% \n  st_transform(crs = 5070) %&gt;%\n  st_union() %&gt;%\n  st_sf()\n\n\n# read in .csv of CONUS-wide attributes\n\nbps_conus_atts &lt;- read_csv(\"inputs/LF20_BPS_220.csv\")\n\n\n# set landscape name---not really needed here but useful if working with many datasets and need to make multiple charts with the same landscape name for example\nlandscape_name &lt;- \"LANDFIRE Map Zone 35 (central Texas)\"  ## CHANGE THIS WHEN YOU ADD IN YOUR AREA OF INTEREST\n\n# create an accessible pallette (from https://thenode.biologists.com/data-visualization-with-flying-colors/research/)\ncustom_palette &lt;- c(\"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\", \"#999999\", \"#E6AB02\", \"#F4A582\")\n\n# plot the shape for fun\nplot(shp)\n\n\n\n\n\n\n\n# look at the first few rows of the CONUS-wide attribute table\nhead(bps_conus_atts)\n\n\nDownload manage and load data\nTo obtain and manage LANDFIRE data we need to:\n\nDefine the Area of Interest (AOI): The code gets the area of interest from a shapefile.\nSet Parameters for the API Call: It specifies the product code, coordinate system (EPSG:4326), resolution (30 meters), and your email address for the API.\nCreate a Temporary File: A temporary file is created to save the downloaded data.\nCall the LANDFIRE API: The API is called with the specified parameters, and the data is saved to the temporary file.\nMake sure the downloaded data lands in a place where you can find and use it easily\n\nDefine the Destination Path: The destination path for the downloaded file is set.\nMove and Rename the File: The temporary file is moved to the destination path and renamed.\nCreate a Temporary Directory for Unzipping: A temporary directory is created to unzip the downloaded file.\nUnzip the File: The file is unzipped into the temporary directory.\nGet the List of Unzipped Files: A list of unzipped files is obtained.\nRename Each Unzipped File: Each unzipped file is renamed to ‚Äúlandfire_data‚Äù followed by its original extension.\nClean Up the Temporary Directory: The temporary directory and its contents are deleted.\n\n\nFinally we load the data into R.\nThe code below does that in roughly 2 minutes with an internet download speed of ~450mbs. Your times may vary.\n```{r}\n#| label: Download manage and load data\n#| echo: true\n#| message: false\n#| warning: false\n#| code-overflow: wrap\n#| include: true\n#| results: hide\n\naoi &lt;- getAOI(shp)\n\nproducts &lt;-  c(\"200BPS\")\nprojection &lt;- 5070  \nresolution &lt;- 30\nemail &lt;- \"rswaty@tnc.org\" # REPLACE WITH YOUR E-MAIL ADDRESS PLEASE! \n\n# R specific arguments\nsave_file &lt;- tempfile(fileext = \".zip\")\n\n# call API\nncal &lt;- landfireAPIv2(\n  products, \n  aoi, \n  projection, \n  resolution, \n  path = save_file,\n  email = email)\n\n\n# define the destination path\ndest_file &lt;- file.path(\"inputs\", \"landfire_data.zip\")\n\n# move and rename the file\nfile.rename(save_file, dest_file)\n\n# create a temporary directory for unzipping\ntemp_dir &lt;- tempfile()\ndir.create(temp_dir)\n\n# unzip the file into the temporary directory\nunzip(dest_file, exdir = temp_dir)\n\n# get the list of unzipped files\nunzipped_files &lt;- list.files(temp_dir, full.names = TRUE)\n\n# rename each unzipped file to \"landfire_data\" with its full original extension\nfor (file in unzipped_files) {\n  file_name &lt;- basename(file)\n  file_extension &lt;- sub(\"^[^.]*\", \"\", file_name)  # Extract the full extension\n  new_file_path &lt;- file.path(\"inputs\", paste0(\"landfire_data\", file_extension))\n  file.rename(file, new_file_path)\n}\n\n# clean up the temporary directory\nunlink(temp_dir, recursive = TRUE)\n\n\n\n```\n\n\nCrop, mask and build attribute table for the area\nNow that we have the BpS data for the extent of our area of interest, we need to crop/mask it to the exact area of interest, build the raster attribute table and do a few calculations:\n\nFirst, we load our stacked raster data from the file landfire_data.tif.\nNext, we crop and mask this raster using a shapefile to focus on our area of interest.\nWe then plot the cropped and masked raster to visualize our area of interest.\nWe set the levels of the raster to match our attribute data and specify the active category.\n\nExtracting and Processing Values: We extract values from the raster, remove any NA values, and convert the data into a dataframe. This dataframe is then processed to create a frequency table, which is further refined and joined with the raster categories.\nSaving the Results: Finally, we save the processed raster and the attributes dataframe to files for future use.\n\n# load downloaded stacked raster\nUS_200BPS &lt;- rast(\"inputs/landfire_data.tif\")\n\n\n# crop and mask the us_200bps raster using the shapefile\nbps_aoi &lt;- US_200BPS %&gt;%\n  crop(shp) %&gt;%\n  mask(shp)\n\n# set the levels of the raster to bps_conus_atts\nlevels(bps_aoi)[[1]] &lt;- bps_conus_atts\n# set the active category of the raster to \"value\"\nactiveCat(bps_aoi) &lt;- \"VALUE\"\n\n# extract values from the raster, remove na values, and convert to dataframe\nbps_aoi_atts &lt;- values(bps_aoi, dataframe = T, na.rm = T) %&gt;%\n  # create a frequency table of the values\n  table(dnn = \"VALUE\") %&gt;%\n  # convert the table to a dataframe\n  as.data.frame() %&gt;%\n  # convert all columns to character type\n  mutate_all(as.character) %&gt;%\n  # convert all columns to integer type\n  mutate_all(as.integer) %&gt;%\n  # join the dataframe with the raster categories\n  left_join(cats(bps_aoi)[[1]], by = \"VALUE\") %&gt;%\n  # filter out rows with a frequency of 0\n  filter(Freq != 0) %&gt;%\n  # calculate acres and relative percentage\n  mutate(ACRES = round((Freq * 900 / 4046.86), 0),\n         REL_PERCENT = round((Freq / sum(Freq)), 3) * 100) %&gt;%\n  # arrange the dataframe by relative percentage in descending order\n  arrange(desc(REL_PERCENT))\n\n# write the raster to a file with specified options\nwriteRaster(bps_aoi, \"outputs/bps_aoi.tif\",\n            gdal = c(\"COMPRESS=NONE\", \"TFW=YES\"),\n            datatype = \"INT2S\",\n            overwrite = T)\n\n# write the attributes dataframe to a dbf file\nwrite.dbf(bps_aoi_atts, \"outputs/bps_aoi.tif.vat.dbf\")\n\n# write the attributes dataframe to a csv file\nwrite.csv(bps_aoi_atts, \"outputs/bps_aoi_attributes.csv\")\n\n# plot the cropped and masked raster\nplot(bps_aoi)\n\n\n\n\n\n\n\n# look at the first few rows of the aoi attributes\nhead(bps_aoi_atts)\n\n\n\nMake a simple bar chart of the top BpSs\n\nbps_name_10 &lt;- bps_aoi_atts %&gt;%\n  group_by(BPS_NAME) %&gt;%\n  summarize(ACRES = sum(ACRES),\n            REL_PERCENT = sum(REL_PERCENT)) %&gt;%\n  arrange(desc(REL_PERCENT)) %&gt;%\n  top_n(n = 10, wt = REL_PERCENT)\n\n# plot\nbps_chart &lt;- \n  ggplot(data = bps_name_10, aes(x = BPS_NAME, y = REL_PERCENT)) +\n  geom_bar(stat = \"identity\", fill = \"#4a4a48\") +\n  coord_flip() +\n  scale_x_discrete(limits = rev(bps_name_10$BPS_NAME)) +\n  theme_bw(base_size = 14) +\n  labs(\n    title = \"Top 10 Biophysical Settings\",\n    subtitle = landscape_name,\n    x = \"\",\n    y = \"Percent\",\n    caption = \"Represents dominant vegetation systems pre-European colonization. \\n Based on LANDFIRE's Biophysical Settings.  Data available at https://www.landfire.gov/viewer. \") + ## SUGGEST ADDING YOUR NAME AND EMAIL IN CAPTION \n  theme(plot.title.position = \"plot\", \n        plot.caption.position =  \"plot\",\n        panel.grid.minor.y = element_blank(),\n        panel.grid.major.y = element_blank())\n  \n\nbps_chart\n\n\n\n\n\n\n\n# if the plot looks good, save it\nggsave(\"outputs/bpsChart.png\", width = 12, height = 5)\n\n\n\nMake Hexbin Map\n\n# Calculate the side length for hexagons with 200 km¬≤ area\nside_length &lt;- sqrt((2 * 200000000) / (3 * sqrt(3)))\n\n# Create a hexagon grid within the shapefile's bounding box\nhex_grid &lt;- st_make_grid(shp, cellsize = side_length, square = FALSE, what = 'polygons')\n\n# Convert the grid to an sf object\nhex_grid &lt;- st_sf(geometry = hex_grid)\n\n# Add an index column to the hexagon grid\nhex_grid &lt;- hex_grid %&gt;%\n  mutate(index = row_number())\n\n\n# Filter hexagons by centroid using st_intersects\nhex_grid &lt;- hex_grid %&gt;%\n filter(lengths(st_intersects(st_centroid(hex_grid), shp)) &gt; 0)\n\n\n# Ensure attributes are correctly handled\nhex_grid &lt;- hex_grid %&gt;%\n st_set_geometry(st_geometry(hex_grid))\n\n\n\n# Perform the exact_extract operation\nbps_majority_hex &lt;- exact_extract(bps_aoi, hex_grid, 'majority', append_cols = \"index\") %&gt;%\n  left_join(select(bps_aoi_atts,\n                   VALUE,\n                   BPS_MODEL,\n                   BPS_NAME),\n            by = c('majority' = 'VALUE'))\n\n\n\n# Join both BpS and EVT attributes to hex shapefile\nhexs_bps&lt;- hex_grid %&gt;%\n  left_join(bps_majority_hex, by = 'index') \n\n\n#| message: false\n#| warning: false\n#| echo: true\n#| fig.width: 10\n#| fig.height: 12\n#| code-overflow: wrap\n\nbps_names &lt;- unique(bps_name_10$BPS_NAME)\n\nbps_colors &lt;- setNames(custom_palette[1:length(bps_names)], bps_names)\n\npal_bps &lt;- colorFactor(\n  palette = bps_colors,\n  domain = hexs_bps$BPS_NAME\n)\n\n\n# Transform the hex_grid to WGS84\nhexs_bps_4326 &lt;- st_transform(hexs_bps, crs = 4326)\n\n\n\nmap &lt;- leaflet(hexs_bps_4326) %&gt;%\n  addTiles() %&gt;%\n  #fitBounds(lng1 = bbox_list$xmin, lat1 = bbox_list$ymin, lng2 = bbox_list$xmax, lat2 = bbox_list$ymax) %&gt;%\n  addPolygons(\n    fillColor = ~pal_bps(BPS_NAME),\n    color = \"#BDBDC3\",\n    weight = 1,\n    opacity = 1,\n    fillOpacity = 1.0,\n    highlightOptions = highlightOptions(\n      weight = 2,\n      color = \"#666\",\n      fillOpacity = 1.0,\n      bringToFront = TRUE\n    ),\n    label = ~BPS_NAME,\n    labelOptions = labelOptions(\n      style = list(\"font-weight\" = \"normal\", padding = \"3px 8px\"),\n      textsize = \"15px\",\n      direction = \"auto\"\n    )\n  ) %&gt;%\n  addScaleBar(position = \"bottomleft\", options = scaleBarOptions(metric = TRUE, imperial = FALSE))\n\nmap\n\n\n\n\n# save map as stand alone HTML file\n\nsaveWidget(map, file = \"bps_hexbin_map.html\")"
  }
]